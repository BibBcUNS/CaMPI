	<SCRIPT LANGUAGE="JavaScript">
	<!-- Begin

	 function presenta_observaciones () {
		 window.open("","Observaciones","width=500,height=300");
		 document.form_observaciones.submit();
	 }

	function renovar(Id) {
	document.getElementById("renovacion_"+Id).innerHTML="<p><font color=#660033><strong><small>Renovado</small></strong></font></p>";
	}


	function verificar() {
		
		// si se selecciona la fecha de vto. a través del almanaque carga este valor en el formulario control
		// modificando el valor del select
		// window.document.control.dias_vto_A Retorna un valor booleano (true|false). Es para comprobar
		// si se están utilizando fechas de vto manual o se calculan posteriormente de acuerdo a las políticas.

		if (window.document.control.dias_vto_A && window.document.control.dias_vto_A.value != "----") {
			window.document.control.dias_prestamo_A.options[window.document.control.dias_prestamo_A.selectedIndex].value = window.document.control.dias_vto_A.value;
		}
			
		if (window.document.control.dias_vto_B && window.document.control.dias_vto_B.value != "----") {
			window.document.control.dias_prestamo_B.options[window.document.control.dias_prestamo_B.selectedIndex].value = window.document.control.dias_vto_B.value;}

		window.document.verifica._enviar_invs.value = "";
		window.document.verifica._devoluciones_invs.value = "";

		for (j = 0; j < 100; j++) {
			element = "dev_" + j;	
			if (document.getElementById(element)) { 
				if (document.getElementById(element).status) {
					window.document.verifica._enviar.value = "1";
		  	        window.document.verifica._devoluciones_invs.value += window.document.getElementById(element).value + "\n"
		  	    }
				else {
					window.document.verifica._enviar_invs.value = document.getElementById(element).value + "\n"
				}
			}
		}

		if (window.document.control.invs_prestamo_A.value != "") {
			window.document.verifica.invs_prestamo_A.value = window.document.control.invs_prestamo_A.value
		}

		if (window.document.control.invs_prestamo_B && window.document.control.invs_prestamo_B.value != "") {
			window.document.verifica.invs_prestamo_B.value = window.document.control.invs_prestamo_B.value
		}

		if (window.document.control.invs_prestamo_A.value != "" || (window.document.control.invs_prestamo_B && window.document.control.invs_prestamo_B.value != "")) {
			window.open("[pft]getenv('PATH_INFO')[/pft]/aguarde.html","VERIFICA","toolbar=0,location=0,directories=0,status=0,menubar=0,scrollbars=1,resizable=0,copyhistory=0,width=400,height=200");
			window.document.verifica.submit();
		}

		if (window.document.control.invs_prestamo_A.value == "" && (!window.document.control.invs_prestamo_B || window.document.control.invs_prestamo_B.value == "") && window.document.verifica._enviar.value == "1" && window.document.control.devolucion_1) {
			window.document.control.submit();
		}

		if (window.document.control.devolucion_1) { 
			if (window.document.control.invs_prestamo_A.value == "" && (!window.document.control.invs_prestamo_B || window.document.control.invs_prestamo_B.value == "") && window.document.verifica._enviar.value == "0") {
				alert ("No se puede enviar el formulario.\nPosibles errores:\n-- > No se ha marcado una devolución.\n-- > No se ha indicado un libro a prestar.");
			}
		}
		else {
			if (window.document.control.invs_prestamo_A.value == "" && (!window.document.control.invs_prestamo_B || window.document.control.invs_prestamo_B.value == "")) {
				alert ("No se puede enviar el formulario.\nError:\n-- > No se ha indicado un libro a prestar.");
			}
		}
	}

	function borrar() {
	window.document.verifica.invs_prestamo_A.value = "";
	window.document.verifica.invs_prestamo_B.value = "";
	}

	function cancelar() {
	window.document.control.operacion.value="CANCELA";
	if (confirm("Cancela la operación ?")) {
          window.document.control.submit()
          }
	}

	function iniciar() {
		var _Fecha = new Date();
		_Fecha.setFullYear([pft]left(date,4)[/pft]);
		_Fecha.setMonth([pft]f(val(mid(date,5,2))-1,1,0)[/pft]);
		_Fecha.setDate([pft]mid(date,7,2)[/pft]);
		var j = 0;
		for (i = 0; i < 61; i++) {
	        var _QueDia = _Fecha.getDay();
		switch (_QueDia) {
			case 1 : _QueDia = "Lunes   "; break;
	 	 	case 2 : _QueDia = "Martes  "; break;
			case 3 : _QueDia = "Mierco. "; break; 
			case 4 : _QueDia = "Jueves  "; break;
			case 5 : _QueDia = "Viernes "; break;
			case 6 : _QueDia = "Sábado  ";
			}
		  if (_Fecha.getDate() < 10) {_Dia = "0" + _Fecha.getDate()} else {_Dia = _Fecha.getDate()};
		  if (_Fecha.getMonth() < 9) {_Mes = "0" + eval(_Fecha.getMonth()+1)} else {_Mes = eval(_Fecha.getMonth()+1)};
		  if (_Fecha.getDay() !="0" && (i < 11 || i == 15 || i == 20 || i == 30 || i == 45 || i == 50 || i == 55 || i == 60)) 
			{if (i == 0) {_Cant = "Hoy"} else {if (i == 1) {_Cant = i + " día"} else {_Cant = i + " días"}};
			 window.document.control.dias_prestamo_A.options[j] = new Option(_Cant + " -> " + _QueDia + _Dia + "/" + _Mes +  "/" + _Fecha.getYear());
			 window.document.control.dias_prestamo_A.options[j].value = _Dia + "/" + _Mes +  "/" + _Fecha.getYear();
			 j++};
		  _Fecha.setHours(_Fecha.getHours() + 24);
		}
		
		var _Fecha = new Date();
		_Fecha.setFullYear([pft]left(date,4)[/pft]);
		_Fecha.setMonth([pft]f(val(mid(date,5,2))-1,1,0)[/pft]);
		_Fecha.setDate([pft]mid(date,7,2)[/pft]);
		var j = 0;
		for (i = 0; i < 61; i++) {
	        var _QueDia = _Fecha.getDay();
		switch (_QueDia) {
			case 1 : _QueDia = "Lunes   "; break;
	 	 	case 2 : _QueDia = "Martes  "; break;
			case 3 : _QueDia = "Mierco. "; break; 
			case 4 : _QueDia = "Jueves  "; break;
			case 5 : _QueDia = "Viernes "; break;
			case 6 : _QueDia = "Sábado  ";
			}
		  if (_Fecha.getDate() < 10) {_Dia = "0" + _Fecha.getDate()} else {_Dia = _Fecha.getDate()};
		  if (_Fecha.getMonth() < 9) {_Mes = "0" + eval(_Fecha.getMonth()+1)} else {_Mes = eval(_Fecha.getMonth()+1)};
		  if (_Fecha.getDay() !="0" && (i < 11 || i == 15 || i == 20 || i == 30 || i == 45 || i == 50 || i == 55 || i == 60)) 
			{if (i == 0) {_Cant = "Hoy"} else {if (i == 1) {_Cant = i + " día"} else {_Cant = i + " días"}};
			 window.document.control.dias_prestamo_B.options[j] = new Option(_Cant + " -> " + _QueDia + _Dia + "/" + _Mes +  "/" + _Fecha.getYear());
			 window.document.control.dias_prestamo_B.options[j].value = _Dia + "/" + _Mes +  "/" + _Fecha.getYear();
			 j++};
		  _Fecha.setHours(_Fecha.getHours() + 24);
		}
	window.document.verifica.enviar.value = "0";
	if (window.document.control.devolucion_1) {window.document.verifica._enviar.value = "0";}
		else {window.document.verifica._enviar.value = "1";}
	window.document.control.invs_prestamo_A.focus();
	}
	// End -->
	</script>

[pft]mhl,

'<table width="100%" border="0">
  <tr>
    <td width="24%"><img src="/omp/circulacion/fotos/',v2,'.jpg" width="128" height="96" align="middle"  OnError="this.src=',"'"n0,'/omp/circulacion/fotos/falta_foto.gif',"'"n0,'"></td>',
   '<td width="76%"><big>',v1,'</big>',", ",v3,
   if v2001:'1' then '<br><marquee bgcolor="#FFF0C4" border="0" style="color: rgb(191,51,83); font-weight: bold" height="19">¡ Lector MOROSO !</marquee>',fi,
   '<br><a href="JavaScript:presenta_observaciones()"><font face="Arial" size="3">Observaciones al Lector</font></a>',
   if p(v17) then '&nbsp;&nbsp;<font face="Arial" size="3"><strong> (Consúltelas!)</strong></font>' fi,
   '</td>
  </tr>
</table>',

if val(s(v16)*6.4,s(v16)*3.2,s(v16)*0.2) < val(s(date).8) then 
	'<h2><center><font color=red><a href="JavaScript:window.document.form_abm.credencial.value=parent.indice.form_id.lector.value; window.document.form_abm.submit()">Actualice los datos del usuario</a></font></center></h2>',
fi


,if v10:'Sancionado' then 
 (if p(v11) then if iocc=nocc(v11) then
   '<blink><big><font color="#FF0000">',if s(v11^v*6,v11^v*3.2,v11^v.2) < s(date).8 then ' Estuvo ' fi,'SANCIONADO hasta el ',v11^v,'</font></big></blink>', fi
  fi)
fi,'<p>',

'<form name="control" method="POST" action="/cgi-bin/wxis.exe/omp/circulacion/" style="margin-bottom: 0">
  <input type="hidden" name="IsisScript" value="/omp/circulacion/prestamo.xis">
  <input type="hidden" name="opcion" value="WRITE">
  <input type="hidden" name="operacion" value="MODIFICA">
  <input type="hidden" name="Vto_AB">
  <input type="hidden" name="operador" value="',v2002,'">
  <input type="hidden" name="mfn_lector" value="',v2003,'">',


if p(v8) then 
'<table border="1" width="100%" bgcolor="FFFFFF">',
 '<tr>',
   '<td width="100%" colspan="3" bgcolor="F5A307"><strong>Marque las devoluciones</strong>',
     if nocc(v8) > 99 then ' (solo las primeras 99)' fi,'</td>',
   '<td bgcolor="F5A307"><strong>Entrega/Vto.</strong>',
 '</tr>',

	'<SCRIPT LANGUAGE="JavaScript">
	<!-- Begin
	    var Fecha_Actual = new Date();
		',if a(v8^o) then '
  	    Fecha_Actual.setHours(0,0,0);' fi,'
	    var Dias_Sancion_Mas_Vieja = 0;
		var Fecha_Sancion_Vigente = new Date(',if p(v11) then v11^v[LAST]*6,', ',f(val(v11^v[LAST]*3.2)-1,2,0),', ',v11^v[LAST].2 
		                                                 else '2000,01,01', fi,');
		if  (Fecha_Sancion_Vigente > Fecha_Actual) {
			var Incremento_Dias_Sancion = (Math.round((Date.parse(Fecha_Sancion_Vigente)-Date.parse(Fecha_Actual))/(24*60*60*1000))*1);}
		else { Incremento_Dias_Sancion = 0;}
	// End -->
	
	</script>',

(

	'<SCRIPT LANGUAGE="JavaScript">
	<!-- Begin
            var Fecha_Vto = new Date(',v8^V*6,', ',f(val(v8^V*3.2)-1,2,0),', ',v8^V.2,if v8^o.4='sala' then ', ',v8^o*6.2,', ',v8^o*9.2 fi,'); 
	    var Calculo_Dias_Sancion = (((Date.parse(Fecha_Actual)-Date.parse(Fecha_Vto))/(24*60*60*1000))*1);
   	    if (Calculo_Dias_Sancion > Dias_Sancion_Mas_Vieja) {
			if (Calculo_Dias_Sancion > 0 && Calculo_Dias_Sancion < 1) {
				Dias_Sancion = 1;
			}
			else {
				Dias_Sancion = Math.round(Calculo_Dias_Sancion);
				Dias_Sancion_Mas_Vieja = Math.round(Calculo_Dias_Sancion);
			}
	    }
	// End -->
	</script>',

 '<tr>',
   '<td align="center" width="15%">', 
      if iocc < 100 then
        '<input type="checkbox" id="dev_',f(iocc,1,0),'" name="devolucion_',f(iocc,1,0),'" value="^x',f(iocc,2,0),'^y',v8^i,'">',
      fi,
      if s(mdu,v8^i.1) : 'X' then mhl,' ? ' else mhl,' Inv: ' fi,
      v8^i,if p(v8^o) then '<br>'v8^o fi,'</td>',
   '<td width="10%">','<div id=',"'"n0,'renovacion_',f(iocc,1,0),"'"n0,'><a onclick="javascript:window.document.control.devolucion_',f(iocc,1,0),'.click();window.document.control.invs_prestamo_A.value += ',"'"n0,replace(v8^i,' ',''),'\n',"'"n0,';renovar(',"'"n0,f(iocc,1,0),"'"n0,')"><img src="/omp/circulacion/images/renovar.gif"></a></div>','</td>',
   '<td width="60%">',v8^b,'</td>',
   '<td align="center" width="15%"',
      if v2001:'1' then ' bgcolor="#BF3353">! ' else '>' fi,
      v8^p.6,v8^p*8'<br><b>Vto ',v8^v.6,,v8^v*8'</b></td></tr>'
),
'</table>',
fi,

'<br>',

if p(v9) then 
'<table border="1" width="100%" bgcolor="FFFFFF">',
 '<tr>',
   '<td width="100%" colspan="3" bgcolor="F5A307"><strong>Ha consultado</strong></td></tr>',
(
 '<tr>',
   '<td width="100%">',mhl,v9,'</td></tr>',
)
'</table><br>',
fi,

if v2001:'1' and v1000^p='manual' then 
'<p style="color: rgb(191,51,83)"><big>Días de sanción:
<select name="dias_sancion" size="1">


	<SCRIPT LANGUAGE="JavaScript">
	<!-- Begin
	    var Total_Dias_Sancion = Dias_Sancion + Incremento_Dias_Sancion;
	    var opcion1 = "<option value=" + Total_Dias_Sancion + " selected>" + Total_Dias_Sancion + " días</option>";
	    document.write(opcion1)
	// End -->
	</script>

    <option value="0">sin sanción</option>
    <option value="1">1 día</option>
    <option value="2">2 días</option>
    <option value="3">3 días</option>
    <option value="4">4 días</option>
    <option value="5">5 días</option>
    <option value="6">6 días</option>
    <option value="7">7 días</option>
    <option value="8">8 días</option>
    <option value="9">9 días</option>
    <option value="10">10 días</option>
    <option value="15">15 días</option>
    <option value="20">20 días</option>
    <option value="30">30 días</option>
</select>
Sanc. Previas:
<select name="sanciones_anteriores" size="1">'
    (if a(v11) or v11='No Sancionado' then '<option>- No Registra -</option>' else '<option>',v11^d,' Días, del ',v11^f,' al ',v11^v,'</option>' fi)
'</select>
</big></p>' 


fi,

'<table border="0" width="100%">
        <tr>
                <td width="100%" colspan="3" bgcolor="F5A307">
                <strong>Pr&eacute;stamos, indique los nros. de Inventario</strong></td></tr>
        <tr>
                <!-- prestamos A -->
                <td valign="middle" width="40%">
                        <p align="center"><strong>Inventarios<br>
                        </strong><textarea rows="5" name="invs_prestamo_A" cols="12"></textarea><br>
                        
                        ',if ref(['config']1,v10)='manual' then '
                        Días de Vigencia:<br>
                        <select name="dias_prestamo_A"
                                    size="1"
                                    onclick="window.document.control.dias_vto_A.value=',"'"n0,'----',"'"n0,';">
                        </select><br>
                        
                        <DIV id=popCal_1 style="BORDER-RIGHT: 2px ridge; BORDER-TOP: 2px ridge; Z-INDEX: 100; VISIBILITY: hidden; BORDER-LEFT: 2px ridge;  BORDER-BOTTOM: 2px ridge; POSITION: absolute" onclick=event.cancelBubble=true>
                        <IFRAME name=popFrame_1
                                       src="\omp\circulacion\popcjs.htm"
                                       frameBorder=0
                                       width=183
                                       scrolling=no
                                       height=188>
                        </IFRAME></DIV>
                        
                        <SCRIPT event=onclick() for=document>popCal_1.style.visibility = "hidden";</SCRIPT>
                        
                        <center>
                        Calendario:
                        <INPUT style="TEXT-ALIGN: center" readOnly value="----" name="dias_vto_A" size="10">
                        <INPUT onclick="window.document.control.Vto_AB.value=',"'"n0,'A',"'"n0,'; popFrame_1.fPopCalendar(dias_vto_A,dias_vto_A,popCal_1);return false;" type=button value=V>
                        </center>
                        ',fi,'
            	</td>
    
                <!-- prestamos B -->',
                if ref(['config']1,v10)='manual' then
                '<td valign="top" width="40%">
                        <p align="center"><strong>Inventarios<br>
                        </strong><textarea rows="5" name="invs_prestamo_B" cols="12"></textarea><br>
                        Días de Vigencia:<br>
                        <select name="dias_prestamo_B"
                                    size="1"
                                    onclick="window.document.control.dias_vto_B.value=',"'"n0,'----',"'"n0,';">
                        </select><br>
                
                    	<DIV id=popCal_2 style="BORDER-RIGHT: 2px ridge; BORDER-TOP: 2px ridge; Z-INDEX: 100; VISIBILITY: hidden; BORDER-LEFT: 2px ridge;  BORDER-BOTTOM: 2px ridge; POSITION: absolute" onclick=event.cancelBubble=true>
                    	<IFRAME name=popFrame_2
                                       src="\omp\circulacion\popcjs.htm" 
                                       frameBorder=0
                                       width=183
                                       scrolling=no
                                       height=188>
                        </IFRAME></DIV>
                	
                    	<SCRIPT event=onclick() for=document>popCal_2.style.visibility = "hidden";</SCRIPT>
                    
                        <center>
                        Calendario:
                        <INPUT style="TEXT-ALIGN: center" readOnly value="----" name="dias_vto_B" size="10">
                        <INPUT onclick="window.document.control.Vto_AB.value=',"'"n0,'B',"'"n0,'; popFrame_2.fPopCalendar(dias_vto_B,dias_vto_B,popCal_2); return false;" type=button value=V>
                        </center>
                </td>
                ',fi,'
                </td>
                        <td valign="top">
                        <p align="center">&nbsp;</p>
                        <p><input type="button" value="  Enviar      " onclick="verificar();return false;"></p>
                        <p><input type="reset"   value="  Limpiar    " onclick="borrar()"></p>
                        <p><input type="button" value="  Cancelar " onclick="cancelar();"></p>
                </td>
  </tr>
</table>

</form>
<br>',

if ref(['config']1,v9)='si' then
	'<table border="0" width="100%" cellspacing="10">
		<tr>
			<td width="100%" colspan="2" bgcolor="F5A307">
			<strong>Reservas</strong>
			</td>
		</tr>
		<tr>
		<td colspan="2">',
			if p(v2030) then
			'<table border="1" width="100%" bgcolor="FFFFFF" cellpadding="4">
				<tr valign="middle">
					<th align="left">Reservas registradas</th><th>Fecha / hora</th><th>Eliminar</th></tr>
					',('<tr valign="middle"><td>',
					ref(['opac_circulacion']l(['opac_circulacion']'LC='v2030^c),
						'<font color="blue"><b>',
							if v100^9='' then
							v100^a," "v100^b," "v100^c," "v100^d," "v100^e,
								else
							v100^9, " "v100^d,
							fi,'</b> : ',
							v245^a," "v245^b,
						'</font><br>
						'),
		
					if v2030^p<>'' then 'Parte: ',v2030^p,'</font><br>' fi,
					'<font color="gray">^b',v2030^b,'^c',v2030^c,'^p',v2030^p,'<br>'
					'</td>
					<td align="center" width="15%">',v2030^f,'<br>',v2030^h,'</td>					
					<td align="center" width="12%">
						<form name="eliminar_',f(iocc,1,0),'" method="POST"
							action="/cgi-bin/wxis.exe/omp/circulacion/" valign="middle">
							<input type="hidden" name="IsisScript"   value="omp/circulacion/reserva_eliminar.xis">
							<input type="hidden" name="usuario_id"  value="',v2[1],'">
							<input type="hidden" name="operario_id" value="',v2002[1],'">
							<input type="hidden" name="reserva_id"  value="^b',v2030^b,'^c',v2030^c,'^p',v2030^p,'">
							<input type="submit" value="Eliminar">
						</form>
					</td>
				</tr>'),			
			'</table>',
			else
				' El usuario no registra Reservas'
			fi
		'</td>
		</tr>
		
		<td colspan="2">',
			if p(v2031) then
			'<table border="1" width="100%" bgcolor="FFFFFF" cellpadding="4">
				<tr valign="middle">
					<th align="left">Esperas registradas</th><th>Fecha / hora</th><th>Eliminar</th></tr>
					',('<tr valign="middle"><td>',
					ref(['opac_circulacion']l(['opac_circulacion']'LC='v2031^c),
						'<font color="blue"><b>',
							if v100^9='' then
							v100^a," "v100^b," "v100^c," "v100^d," "v100^e,
								else
							v100^9, " "v100^d,
							fi,'</b> : ',
							v245^a," "v245^b,
						'</font><br>
						'),
		
					if v2031^p<>'' then 'Parte: ',v2031^p,'</font><br>' fi,
					'<font color="gray">^b',v2031^b,'^c',v2031^c,'^p',v2031^p,'<br>'
					'</td>
					<td align="center" width="15%">',v2031^f,'<br>',v2031^h,'</td>
					<td align="center" width="12%">
						<form name="eliminar_',f(iocc,1,0),'" method="POST"
							action="/cgi-bin/wxis.exe/omp/circulacion/" valign="middle">
							<input type="hidden" name="IsisScript"   value="omp/circulacion/espera_eliminar.xis">
							<input type="hidden" name="usuario_id"  value="',v2[1],'">
							<input type="hidden" name="operario_id" value="',v2002[1],'">
							<input type="hidden" name="reserva_id"  value="^b',v2031^b,'^c',v2031^c,'^p',v2031^p,'">
							<input type="submit" value="Eliminar">
						</form>
					</td>
				</tr>'),			
			'</table>',
			else
				' El usuario no registra Esperas'
			fi
		'</td>
		</tr>
		
		<tr>
			<td>
				<form name="consultas" method="POST" action="/cgi-bin/wxis.exe/omp/circulacion/">
				<input type="hidden" name="IsisScript" value="omp/circulacion/consulta.xis">
				<input type="hidden" name="criterio" value="otro">
				<input type="hidden" name="usuario_id" value="',v2,'">
				<input type="hidden" name="operario_id" value="',v2002,'">
	
				<table border="0" width="100%" cellpadding="0" cellspacing="0">
					<tr>
						<td width="100%"><strong><u>R</u>eservar material: </strong>
						<input type="text" name="expresion" size="15" accesskey="r">
						<input type="submit" value="Enviar">
						<a href="/omp/circulacion/marc_fst.txt" target="new">?</a>
					</tr>					
				</table>
				</form>
			</td>
		</tr>
		
	</table>',

fi,

'<form name="verifica" method="POST" action="/cgi-bin/wxis.exe/omp/circulacion/" target="VERIFICA">
  <input type="hidden" name="IsisScript" value="/omp/circulacion/control.xis">
  <input type="hidden" name="invs_prestamo_A">
  <input type="hidden" name="invs_prestamo_B">
  <input type="hidden" name="enviar">
  <input type="hidden" name="_enviar">
  <input type="hidden" name="_enviar_invs">
  <input type="hidden" name="_devoluciones_invs">
  <input type="hidden" name="documento" value="',v2,'">
</form>

<form name="form_observaciones" method="POST" action="/cgi-bin/wxis.exe/omp/circulacion/" target="Observaciones">  
	<input type="hidden" name="IsisScript" value="/omp/circulacion/observaciones_lector.xis">  
	<input type="hidden" name="opcion" value="PRESENTAR">  
	<input type="hidden" name="operador" value="',v2002,'">  
	<input type="hidden" name="mfn_lector" value="',v2003,'">
</form>

<script>
    iniciar();
</script>
</font>'
[/pft] 

